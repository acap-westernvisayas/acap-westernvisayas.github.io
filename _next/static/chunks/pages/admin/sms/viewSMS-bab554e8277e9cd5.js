(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8226],{5835:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/sms/viewSMS",function(){return n(64114)}])},38554:function(t,e){"use strict";e.Z={button:{color:"#FFFFFF",textTransform:"capitalize",fontSize:"14px",fontStyle:"normal",fontWeight:"normal",width:"80px",height:{xs:"40px",sm:"48px"}},container:{padding:"24px",width:"100%",position:"relative",minWidth:"0px",overflowWrap:"break-word",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"16px",margin:"auto",borderColor:"#E2E8F0"},tabsContainer:{marginTop:function(t){return t.spacing(8)},border:function(t){return"1px solid ".concat(t.palette.bacap.border)},minHeight:"800px",borderRadius:"8px",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px"},customizedButtonLink:{cursor:"pointer",color:"#8BC24A",textDecoration:"underline",fontWeight:600}}},64114:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return lt}});var r=n(34051),o=n.n(r),i=n(85893),c=n(67294),a=n(11163),u=n(95243),s=n(87006),l=n(40558),f=n(66383),d=n(47426),p=n(77715),h=n(87357),v=n(15861),m=n(56863),b=n(11057),y=n(67720),x=n(86886),g=n(27948),j=n(36872),O=n(72890),w=n(50480),S=n(94054),T=n(40476),C=n(98396),k=n(9669),P=n.n(k),E=n(99431);function _(t,e,n,r,o,i,c){try{var a=t[i](c),u=a.value}catch(s){return void n(s)}a.done?e(u):Promise.resolve(u).then(r,o)}function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},B(t)}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){N(t,e,n[e])}))}return t}function F(t,e){return!e||"object"!==L(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function A(t,e){return A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},A(t,e)}var L=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function I(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=B(t);if(e){var o=B(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return F(this,n)}}var M={BASE_API_URL:"http://localhost:3001/api",SEND_SMS_RECOMMENDATIONS:"".concat("http://localhost:3001/api","/send")},q=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(c,t);var e,n,r,i=I(c);function c(){return R(this,c),i.apply(this,arguments)}return e=c,n=[{key:"sendSMS",value:function(t){var e,n=this;return(e=o().mark((function e(){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.createRequestObject({body:t});case 2:return r=e.sent,e.next=5,P()(D({},r,{url:M.SEND_SMS_RECOMMENDATIONS,method:"POST"}));case 5:return i=e.sent,e.abrupt("return",i.data);case 7:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function c(t){_(i,r,o,c,a,"next",t)}function a(t){_(i,r,o,c,a,"throw",t)}c(void 0)}))})()}}],n&&Z(e.prototype,n),r&&Z(e,r),c}(E.Z),z=new q,W=z.sendSMS.bind(z),X=n(16759),G=n(37634),H=n(19227),K=n(27392),U=n(38199),Q=n(38554),V=n(77841),Y=n(69437),J=n(15799),$=n(71927);function tt(t,e,n,r,o,i,c){try{var a=t[i](c),u=a.value}catch(s){return void n(s)}a.done?e(u):Promise.resolve(u).then(r,o)}function et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function nt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){et(t,e,n[e])}))}return t}var rt=(0,J.Z)();rt.typography.h5=et({fontSize:"1.2rem","@media (min-width:600px)":{fontSize:"1.5rem"}},rt.breakpoints.up("md"),{fontSize:"2rem"});var ot=function(t){var e,n=t.contacts,r=t.contactsState,u=t.onBackBtnClick,s=t.report,l=t.setReport,f=t.loading,d=(0,c.useState)(null),p=d[0],k=d[1],P=(0,c.useState)(null),E=P[0],_=P[1],R=(0,c.useState)([]),Z=R[0],N=R[1],B=(0,a.useRouter)(),D=(0,Y.Z)(s,[U.X3.REGION,U.X3.TYPE,U.X3.UID,U.X3.ID]).fieldValues;(0,c.useEffect)((function(){0!==n.length&&A(n)}),[n]);var F,A=function(t){var e=t.reduce((function(t,e){return void 0===t[e.municipality]&&(t[e.municipality]={contacts:[],province:e.province}),t[e.municipality].contacts.push(e),nt({},t)}),{});k(e)},L=(0,C.Z)(rt.breakpoints.between("xs","md")),I=function(){var t,e=(t=o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==s.info){t.next=17;break}return l(nt({},s,{sending:!0})),e=[],r=[],Z.map((function(t){var o=n.find((function(e){return e.id===t}));o?(e.push(o.cellnumber),r.push(""===o.name?o.cellnumber:o.name)):e.push(t)})),t.prev=5,t.next=8,W({docId:s.id,recipientsNumber:e.toString(),message:s.smsRecommendations,currentSmsLogs:(null===s||void 0===s?void 0:s.logs)?s.logs:[],recipientsWithName:r.toString()});case 8:l((function(t){return nt({},t,{sending:!1,info:"Crop Recommendation sent."})})),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(5),B.push({pathname:"/admin/sms/",query:{isSent:!1}},"/admin/sms/"),console.error(t.t0.message);case 15:t.next=18;break;case 17:B.push({pathname:"/admin/sms/"});case 18:case"end":return t.stop()}}),t,null,[[5,11]])})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){tt(i,r,o,c,a,"next",t)}function a(t){tt(i,r,o,c,a,"throw",t)}c(void 0)}))});return function(){return e.apply(this,arguments)}}(),M=function(){B.push({pathname:"/admin/sms/",query:{toAddContact:!0}},"/admin/sms/")};return(0,i.jsx)("div",{children:f||s.loading?(0,i.jsx)(X.Z,{}):void 0!==s.stages?(0,i.jsxs)(h.Z,{container:!0,sx:Q.Z.container,children:[(0,i.jsxs)(h.Z,{sx:{marginBottom:"32px",display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)($.Z,{theme:rt,children:(0,i.jsxs)(h.Z,{children:[(0,i.jsx)(v.Z,{variant:"h5",children:"Send Text-Form Crop Recommendation"}),(0,i.jsx)(v.Z,{variant:"h6",children:K.eT[s.type]})]})}),(0,i.jsxs)(m.Z,{orientation:L?"vertical":"horizontal",children:[(0,i.jsx)(b.Z,{disableElevation:!0,variant:"outlined",color:"primary",sx:nt({},Q.Z.button,{color:function(t){return t.palette.primary.main},borderTopRightRadius:0,borderBottomRightRadius:0}),onClick:u,children:"Back"}),(0,i.jsx)(H.Z,{isDisabled:0===Z.length||void 0===(null===s||void 0===s?void 0:s.smsRecommendations),isOpen:!1,maxWidth:"sm",openButtonText:"Send",title:"Send Crop Recommendation",contentText:""!==s.info?s.info:"Sending this allows your contacts to receive the Text-Form Crop Recommendation on their cellphone numbers as text.",confirmBtnText:""!==s.info?"Ok":"Send",modalConfirmHandlerCB:I,loading:s.sending,modalButtonStyles:{borderTopLeftRadius:0,borderBottomLeftRadius:0,width:"80px"}})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)(h.Z,{sx:V.Z.details,children:[D.map((function(t){return(0,i.jsx)("div",{children:(0,i.jsxs)(v.Z,{variant:"body2",children:[(0,i.jsxs)("strong",{children:[null===t||void 0===t?void 0:t.label,": "]})," ",null!==(F=null===t||void 0===t?void 0:t.value)&&void 0!==F?F:"-"]})},t.id)})),(0,i.jsxs)(v.Z,{variant:"caption",children:[(0,i.jsx)("strong",{children:"ID:"})," ",s.id]})]}),(0,i.jsx)(y.Z,{sx:{marginTop:"32px"}})]}),(0,i.jsxs)(x.ZP,{container:!0,style:{paddingTop:"10px"},children:[(0,i.jsxs)(x.ZP,{item:!0,xs:12,md:5,children:[(0,i.jsx)(v.Z,{variant:"h6",children:"Text-Form Crop Recommendation"}),(0,i.jsx)(g.Z,{children:(null===s||void 0===s?void 0:s.smsRecommendations)||(0,i.jsx)("span",{style:{color:"#ff1744"},children:"No SMS Recommendations available."})})]}),(0,i.jsxs)(x.ZP,{item:!0,xs:12,md:7,children:[(0,i.jsx)(v.Z,{variant:"h6",children:"List of Contacts"}),r.loading?(0,i.jsx)("div",{children:"Loading phonebook..."}):""!==r.error?(0,i.jsx)("div",{children:r.error}):n.length>0?(0,i.jsxs)("div",{children:[(0,i.jsx)(h.Z,{children:(0,i.jsxs)(v.Z,{variant:"body2",children:["These are your contacts that you can send the recommendation thru SMS.",(0,i.jsx)("br",{}),"Need to change some of your contacts? Click"," ",(0,i.jsx)("span",{onClick:M,style:Q.Z.customizedButtonLink,children:"here"}),"."]})}),(0,i.jsx)("div",{style:{height:"400px",width:"100%",paddingTop:"50px"},children:(0,i.jsxs)(S.Z,{children:[(0,i.jsx)(T.Z,{id:"demo-controlled-radio-buttons-group",children:"Select Province for Text Blasting"}),(0,i.jsx)(O.Z,{"aria-labelledby":"demo-controlled-radio-buttons-group",name:"controlled-radio-buttons-group",value:E,onChange:function(t){_(t.target.value);var e=p[t.target.value].contacts.map((function(t){return t.cellnumber}));N(e)},children:(null===(e=Object.keys(p))||void 0===e?void 0:e.length)>0?(0,i.jsx)("div",{children:Object.keys(p).sort().map((function(t){return(0,i.jsx)(w.Z,{value:t,control:(0,i.jsx)(j.Z,{}),label:"".concat(t,", ").concat(p[t].province)},t)}))}):null})]})})]}):(0,i.jsx)("div",{children:(0,i.jsxs)(v.Z,{variant:"subtitle1",children:["No contacts yet. Please add contacts first in your Phonebook\xa0",(0,i.jsx)("span",{onClick:M,style:Q.Z.customizedButtonLink,children:"here"}),"."]})})]})]})]}):(0,i.jsx)(G.Z,{})})};function it(t,e,n,r,o,i,c){try{var a=t[i](c),u=a.value}catch(s){return void n(s)}a.done?e(u):Promise.resolve(u).then(r,o)}function ct(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){it(i,r,o,c,a,"next",t)}function a(t){it(i,r,o,c,a,"throw",t)}c(void 0)}))}}function at(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){at(t,e,n[e])}))}return t}var st={loading:!0,error:"",info:"",sending:!1};var lt=(0,u.Z)((function(t){var e=(0,c.useState)(st),n=e[0],r=e[1],u=(0,c.useState)(st),h=u[0],v=u[1],m=(0,c.useState)([]),b=m[0],y=m[1],x=(0,a.useRouter)();return(0,c.useEffect)((function(){if(n.loading&&Object.keys(x.query).length>0&&null!==t.user){var e=function(){var t=ct(o().mark((function t(){var e,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,s.QL)(x.query.docId);case 3:e=t.sent,n=e.date_created.toDate(),e.date_created="".concat(n.toDateString()," ").concat(n.toLocaleTimeString("it-IT",p.W6)),r((function(t){return ut({},t,{loading:!1},e)})),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),r(ut({},st,{loading:!1,error:t.t0.message}));case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}(),i=function(){var t=ct(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,v(ut({},st,{loading:!0})),t.next=4,(0,l.K2)();case 4:e=t.sent,y((function(t){return e})),v((function(t){return ut({},t,{loading:!1})})),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),r((function(e){return ut({},st,{loading:!1,error:t.t0.message})})),v((function(e){return ut({},st,{loading:!1,error:t.t0.message})}));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}();e(),i()}}),[x,n.loading,t.user]),(0,i.jsx)(f.Z,{loading:t.loading,user:t.user,onBtnLogoutClick:t.onBtnLogoutClick,accLevel:d.DW.ADMIN,children:(0,i.jsx)(ot,{setReport:r,report:n,loading:t.loading,contacts:b,contactsState:h,onBackBtnClick:function(){x.push("/admin/sms/")}})})}))},40558:function(t,e,n){"use strict";n.d(e,{rE:function(){return O},GK:function(){return w},mP:function(){return S},K2:function(){return T}});var r=n(34051),o=n.n(r),i=n(9669),c=n.n(i),a=n(99431);function u(t,e,n,r,o,i,c){try{var a=t[i](c),u=a.value}catch(s){return void n(s)}a.done?e(u):Promise.resolve(u).then(r,o)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){u(i,r,o,c,a,"next",t)}function a(t){u(i,r,o,c,a,"throw",t)}c(void 0)}))}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){d(t,e,n[e])}))}return t}function v(t,e){return!e||"object"!==b(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function m(t,e){return m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},m(t,e)}var b=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function y(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=p(t);if(e){var o=p(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return v(this,n)}}var x={BASE_API_URL:"http://localhost:3001/api",CREATE_CONTACT:"".concat("http://localhost:3001/api","/contact"),DELETE_CONTACT:"".concat("http://localhost:3001/api","/contact"),EDIT_CONTACT:"".concat("http://localhost:3001/api","/contact"),GET_CONTACTS:"".concat("http://localhost:3001/api","/contacts"),PHONEBOOK:"phonebook"},g=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(a,t);var e,n,r,i=y(a);function a(){return l(this,a),i.apply(this,arguments)}return e=a,(n=[{key:"createContact",value:function(t){var e=this;return s(o().mark((function n(){var r,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.createRequestObject({body:t});case 2:return r=n.sent,n.next=5,c()(h({},r,{url:x.CREATE_CONTACT,method:"POST"}));case 5:return i=n.sent,n.abrupt("return",i.data);case 7:case"end":return n.stop()}}),n)})))()}},{key:"deleteContact",value:function(t){var e=this;return s(o().mark((function n(){var r,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.createRequestObject({body:t});case 2:return r=n.sent,n.next=5,c()(h({},r,{url:x.DELETE_CONTACT,method:"DELETE"}));case 5:return i=n.sent,n.abrupt("return",i.data);case 7:case"end":return n.stop()}}),n)})))()}},{key:"editContact",value:function(t){var e=this;return s(o().mark((function n(){var r,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.createRequestObject({body:t});case 2:return r=n.sent,n.next=5,c()(h({},r,{url:x.EDIT_CONTACT,method:"PATCH"}));case 5:return i=n.sent,n.abrupt("return",i.data);case 7:case"end":return n.stop()}}),n)})))()}},{key:"getContacts",value:function(){var t=this;return s(o().mark((function e(){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createRequestObject({});case 2:return n=e.sent,e.next=5,c()(h({},n,{url:x.GET_CONTACTS,method:"GET"}));case 5:return r=e.sent,e.abrupt("return",r.data.contacts);case 7:case"end":return e.stop()}}),e)})))()}}])&&f(e.prototype,n),r&&f(e,r),a}(a.Z),j=new g,O=j.createContact.bind(j),w=j.deleteContact.bind(j),S=j.editContact.bind(j),T=j.getContacts.bind(j)}},function(t){t.O(0,[5778,3593,9964,8858,6279,542,7288,986,9872,1050,2774,9774,2888,179],(function(){return e=5835,t(t.s=e);var e}));var e=t.O();_N_E=e}]);